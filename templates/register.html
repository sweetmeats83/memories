{% extends "base.html" %}
{% block content %}


<div class="flex items-center justify-center min-h-screen">
  <div class="text-center rounded-lg bg-white/30 p-10 backdrop-blur-md shadow-lg inline-block  animate-fadeIn w-full max-w-md">
    <h1 class="text-4xl font-bold mb-6 tracking-wider flex items-center justify-center gap-2">
      <span class="material-symbols-outlined">person_add</span> SETUP ACCOUNT
    </h1>
    <form id="registerForm" class="space-y-6">
      <!-- Email Field (read-only, prefilled from invite token) -->
      <div class="relative">
        <input type="email" name="email" id="email" readonly
          class="peer w-full p-3 border-b-2 border-gray-300 bg-gray-100 placeholder-transparent text-black">
        <label for="email"
          class="absolute left-3 -top-3.5 text-gray-700 text-sm">
          Email Address
        </label>
        <span class="material-symbols-outlined absolute right-2 top-3 text-gray-400">mail</span>
      </div>

      <!-- Password Field -->
      <div class="relative">
        <input type="password" name="password" id="password" required
          class="peer w-full p-3 border-b-2 border-gray-300 bg-transparent placeholder-transparent focus:outline-none focus:border-orange-500 text-black">
        <label for="password"
          class="absolute left-3 -top-3.5 text-gray-700 text-sm transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-3.5 peer-focus:text-sm peer-focus:text-orange-500">
          New Password
        </label>
        <span class="material-symbols-outlined absolute right-2 top-3 text-gray-400">lock</span>
      </div>

      <!-- Confirm Password Field -->
      <div class="relative">
        <input type="password" name="confirm_password" id="confirm_password" required
          class="peer w-full p-3 border-b-2 border-gray-300 bg-transparent placeholder-transparent focus:outline-none focus:border-orange-500 text-black">
        <label for="confirm_password"
          class="absolute left-3 -top-3.5 text-gray-700 text-sm transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-3.5 peer-focus:text-sm peer-focus:text-orange-500">
          Confirm Password
        </label>
        <span class="material-symbols-outlined absolute right-2 top-3 text-gray-400">lock_reset</span>
      </div>

      <!-- Setup Button -->
      <button type="submit"
        class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors duration-300 flex items-center justify-center gap-2">
        <span class="material-symbols-outlined">done_all</span> Complete Setup
      </button>
    </form>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Example: Prefill email from query string (invite link)
  const params = new URLSearchParams(window.location.search);
  const emailField = document.getElementById("email");
  if (params.has("email")) {
    emailField.value = params.get("email");
  }
});

document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const confirmPassword = document.getElementById("confirm_password").value.trim();

  if (password !== confirmPassword) {
    showNotification("❌ Passwords do not match.", "error");
    return;
  }

  try {
    const res = await fetch("/auth/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    if (res.ok) {
      showNotification("✅ Account setup complete! Redirecting...", "success");
      setTimeout(() => {
        window.location.href = "/login";
      }, 1000);
    } else {
      const error = await res.json();
      showNotification(error.detail || "⚠️ Registration failed.", "error");
    }
  } catch (err) {
    showNotification("⚠️ Network error. Please try again.", "error");
  }
});
</script>
{% endblock %}
